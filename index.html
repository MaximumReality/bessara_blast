<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>Mochkil's Snack Attack | Maximum Reality</title>

<style>
:root {
    --neon-green: #39FF14;
    --neon-pink: #FF00FF;
    --neon-blue: #00FFEF;
}

body {
    margin: 0;
    background: #000 url('mochkils_kitchen.PNG') center/cover fixed;
    height: 100vh;
    overflow: hidden;
    font-family: 'Courier New', Courier, monospace;
}

/* SCREENS */
#welcome-screen, #game-screen {
    position: absolute;
    inset: 0;
}

#welcome-screen {
    background: rgba(0,0,0,0.75);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
}

/* UI */
#ui {
    position: absolute;
    top: 40px;
    left: 20px;
    color: var(--neon-green);
    font-size: 18px;
    font-weight: bold;
    text-shadow: 2px 2px #000;
    z-index: 20;
    pointer-events: none;
}

#progress-container {
    position: absolute;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    width: 70%;
    height: 14px;
    border: 2px solid var(--neon-blue);
    border-radius: 10px;
    background: rgba(0,255,239,0.1);
    z-index: 20;
    display: none;
}

#progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--neon-blue), var(--neon-green));
    border-radius: 8px;
}

/* BUTTONS */
.menu-btn {
    width: 280px;
    padding: 20px;
    margin: 10px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 15px var(--neon-green);
}

.btn-infinite {
    background: var(--neon-blue);
    box-shadow: 0 0 15px var(--neon-blue);
}

#home-btn, #sound-btn {
    position: absolute;
    right: 20px;
    padding: 10px 15px;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    z-index: 30;
}

#home-btn {
    top: 40px;
    background: var(--neon-pink);
    display: none;
}

#sound-btn {
    top: 90px;
    background: var(--neon-blue);
}

canvas {
    position: absolute;
    inset: 0;
    z-index: 5;
}

/* VICTORY VIDEO WRAPPER */
#victory-wrapper {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    background: #000;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.5s ease;
}

#victory-wrapper video {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
}

/* HEADINGS */
h1 {
    color: var(--neon-pink);
    text-shadow: 3px 3px #000;
}
</style>
</head>

<body>

<!-- WELCOME -->
<div id="welcome-screen">
    <h1>SNACK ATTACK<br>BESSARA BLAST</h1>
    <button class="menu-btn" onclick="startGame('levels')">GOAL MODE (1000)</button>
    <button class="menu-btn btn-infinite" onclick="startGame('infinite')">INFINITE CHAOS</button>
    <button class="menu-btn" onclick="location.href='https://MaximumReality.xyz'">üè† MAIN SITE</button>
</div>

<!-- GAME -->
<div id="game-screen" style="display:none;">
    <div id="ui">
        BASIRAH: <span id="score">0</span><br>
        ‚≠ê <span id="stars"></span><br>
        üèÜ BEST: <span id="best">0</span>
    </div>

    <div id="progress-container"><div id="progress-bar"></div></div>
    <button id="home-btn" onclick="goHome()">üè† HOME</button>
    <button id="sound-btn">üîä</button>
    <canvas id="gameCanvas"></canvas>
</div>

<!-- VICTORY -->
<div id="victory-wrapper">
    <video id="victory-video" playsinline preload="auto">
        <source src="victory_scene.MP4" type="video/mp4">
    </video>
</div>

<script>
/* --- CANVAS --- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

/* --- UI --- */
const scoreEl = document.getElementById('score');
const starsEl = document.getElementById('stars');
const bestEl = document.getElementById('best');
const progressBar = document.getElementById('progress-bar');
const progressCont = document.getElementById('progress-container');
const welcome = document.getElementById('welcome-screen');
const game = document.getElementById('game-screen');
const homeBtn = document.getElementById('home-btn');
const soundBtn = document.getElementById('sound-btn');
const victoryWrapper = document.getElementById('victory-wrapper');
const victory = document.getElementById('victory-video');

/* --- ASSETS --- */
const chefHappy = new Image(); chefHappy.src = 'mochkil_happy.png';
const chefChaos = new Image(); chefChaos.src = 'mochkil_chaos.png';
const azul = new Image(); azul.src = 'azul_insight.png';

/* --- AUDIO --- */
const music = new Audio('snack_attack_theme.mp3');
music.loop = true;
music.volume = 0.4;

const straightFireSFX = new Audio('straight_fire.mp3');
const beastModeIntro = new Audio('fava.mp3');

/* --- SOUND TOGGLE --- */
let soundOn = localStorage.getItem('soundOn') !== 'false';
function applySound(){
    music.muted = !soundOn;
    straightFireSFX.muted = !soundOn;
    beastModeIntro.muted = !soundOn;
    victory.muted = !soundOn;
    soundBtn.textContent = soundOn ? 'üîä' : 'üîà';
}
applySound();

soundBtn.onclick = () => {
    soundOn = !soundOn;
    localStorage.setItem('soundOn', soundOn);
    applySound();
};

/* --- GAME STATE --- */
let score = 0;
let best = localStorage.getItem('mochkil_best') || 0;
bestEl.textContent = best;

let chefX = canvas.width / 2;
let items = [];
let gameOn = false;
let mode = 'levels';

let sugar = false;
let michelinStars = 0;
let isBeastMode = false;

const goal = 1000;
const milestone = 100;
const floorY = canvas.height - 150;

// --- ASSETS ---
const beanImg = new Image(); 
beanImg.src = 'fava_bean.png'; 

class Item {
    constructor(type) {
        this.type = type;
        this.x = Math.random() * (canvas.width - 60) + 30;
        this.y = -50;
        // Keep your original speed or use the new random range
        this.speed = type === 'bean' ? (4 + Math.random() * 3) : 8;
        this.rotation = Math.random() * Math.PI * 2; 
    }

    update() {
        // Keeps your Beast Mode speed logic
        const boost = (typeof isBeastMode !== 'undefined' && isBeastMode) ? 1.6 : 1;
        this.y += this.speed * boost;
        this.rotation += 0.05; 

        // Collision Logic (Uses floorY to match your script)
        if (this.y > floorY - 100 && this.y < floorY && this.x > chefX - 60 && this.x < chefX + 60) {
            if (this.type === 'bean') {
                score += (typeof isBeastMode !== 'undefined' && isBeastMode) ? 20 : 10;
                scoreEl.textContent = score;

                // High Score Update
                if (score > best) {
                    best = score;
                    bestEl.textContent = best;
                    localStorage.setItem('mochkil_best', best);
                }

                // SFX Logic
                if (score % 50 === 0 && typeof straightFireSFX !== 'undefined') {
                    straightFireSFX.currentTime = 0;
                    straightFireSFX.play();
                }

                if (typeof checkBeastMode === 'function') checkBeastMode();

                // Progress Bar & Win Condition
                if (mode === 'levels') {
                    progressBar.style.width = Math.min(score / goal * 100, 100) + '%';
                    if (score >= goal) win();
                }
            } else {
                triggerCrash();
            }
            this.y = canvas.height + 500;
        }
    }

    draw() {
        if (this.type === 'bean') {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation);
            
            // Add neon glow for the Bessara Blast vibe
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#39FF14';

            if (beanImg.complete) {
                ctx.drawImage(beanImg, -22, -22, 44, 44); 
            } else {
                ctx.fillStyle = '#98FB98';
                ctx.beginPath();
                ctx.ellipse(0, 0, 18, 12, 0, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.restore();
        } else {
            ctx.font = '45px Arial';
            ctx.fillText('üç™', this.x - 22, this.y);
        }
    }
}

/* --- GAME CONTROL --- */
function startGame(m){
    mode = m;
    score = 0;
    michelinStars = 0;
    items = [];
    scoreEl.textContent = '0';
    starsEl.textContent = '';
    progressBar.style.width = '0%';

    welcome.style.display = 'none';
    game.style.display = 'block';
    homeBtn.style.display = 'block';
    progressCont.style.display = m === 'levels' ? 'block' : 'none';

    music.currentTime = 0;
    music.play();
    gameOn = true;
    loop();
}

function goHome(){
    gameOn = false;
    music.pause();
    game.style.display = 'none';
    welcome.style.display = 'flex';
    homeBtn.style.display = 'none';
    soundBtn.style.display = 'block';
}

function win(){
    gameOn = false;
    music.pause();

    // Hide all game UI
    canvas.style.display = 'none';
    document.getElementById('ui').style.display = 'none';
    homeBtn.style.display = 'none';
    progressCont.style.display = 'none';
    soundBtn.style.display = 'none';

    // Show victory video wrapper
    victoryWrapper.style.display = 'flex';
    victoryWrapper.style.opacity = 0;

    // Fade in
    let fadeIn = 0;
    const fadeInterval = setInterval(()=>{
        fadeIn += 0.05;
        victoryWrapper.style.opacity = Math.min(fadeIn,1);
        if(fadeIn >= 1) clearInterval(fadeInterval);
    }, 30);

    // Play video
    victory.currentTime = 0;
    victory.play();

    victory.onended = ()=>{
        // Fade out
        let fadeOut = 1;
        const fadeOutInterval = setInterval(()=>{
            fadeOut -= 0.05;
            victoryWrapper.style.opacity = Math.max(fadeOut,0);
            if(fadeOut <= 0){
                clearInterval(fadeOutInterval);
                location.reload();
            }
        },30);
    };
}

/* --- INPUT --- */
canvas.addEventListener('mousemove', e => chefX = e.clientX);
canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    chefX = e.touches[0].clientX;
},{passive:false});

/* --- LOOP --- */
function loop(){
    if(!gameOn) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(Math.random() < 0.05) items.push(new Item('bean'));
    if(Math.random() < 0.01) items.push(new Item('cookie'));

    items.forEach(i => { i.update(); i.draw(); });

    const sprite = sugar ? chefChaos : chefHappy;
    if(sprite.complete){
        ctx.drawImage(sprite, chefX-75, floorY-130, 150,150);
    }

    if(isBeastMode && azul.complete){
        ctx.drawImage(azul, canvas.width/2 - 90, 80, 180, 180);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px Courier New';
        ctx.textAlign = 'center';
        ctx.fillText('BEAST MODE BESSARA!', canvas.width/2, 300);
    }

    requestAnimationFrame(loop);
}
</script>
</body>
</html>
